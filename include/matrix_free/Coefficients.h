// Copyright 2017 National Technology & Engineering Solutions of Sandia, LLC
// (NTESS), National Renewable Energy Laboratory, University of Texas Austin,
// Northwest Research Associates. Under the terms of Contract DE-NA0003525
// with NTESS, the U.S. Government retains certain rights in this software.
//
// This software is released under the BSD 3-clause license. See LICENSE file
// for more details.
//

#ifndef CVFEM_COEFFICIENTS_H
#define CVFEM_COEFFICIENTS_H

#include "matrix_free/LocalArray.h"

// An option to use a symmetric version of
// the P=2 CVFEM operator.  This loses one to two orders
// of accuracy and is (likely) not possible for p>=4
// but allows use of CG and streamlines analysis
// of the method
#ifndef USE_SYMMETRIC
#define USE_SYMMETRIC 0
#endif

namespace sierra {
namespace nalu {
namespace matrix_free {
template <int p>
struct Coeffs
{
};

template <>
struct Coeffs<1>
{
  using nodal_matrix_type = LocalArray<double[2][2]>;
  using scs_matrix_type = LocalArray<double[1][2]>;
  using linear_nodal_matrix_type = LocalArray<double[2][2]>;
  using linear_scs_matrix_type = LocalArray<double[2][1]>;
  static constexpr nodal_matrix_type W = {{{0.75, 0.25}, {0.25, 0.75}}};

  static constexpr nodal_matrix_type D = {{{-0.5, +0.5}, {-0.5, 0.5}}};

  static constexpr scs_matrix_type Nt = {{{+0.5, +0.5}}};
  static constexpr scs_matrix_type Dt = {{{-0.5, +0.5}}};

  static constexpr linear_nodal_matrix_type Nlin = {{{1, 0}, {0, 1}}};
  static constexpr linear_scs_matrix_type Ntlin = {{{0.5}, {0.5}}};

  static constexpr LocalArray<double[2]> Wl = {{1, 1}};
};

#if USE_SYMMETRIC
template <>
struct Coeffs<2>
{
  using nodal_matrix_type = LocalArray<double[3][3]>;
  using scs_matrix_type = LocalArray<double[2][3]>;
  using linear_nodal_matrix_type = LocalArray<double[2][3]>;
  using linear_scs_matrix_type = LocalArray<double[2][2]>;

  static constexpr nodal_matrix_type W = {
    {{0.2561728395061728395062, 0.09876543209876543209877,
      -0.02160493827160493827160},
     {0.09876543209876543209877, 1.135802469135802469136,
      0.09876543209876543209877},
     {-0.02160493827160493827160, 0.09876543209876543209877,
      0.2561728395061728395062}}};

  static constexpr nodal_matrix_type D = {
    {{-1.5, +2.0, -0.5}, {-0.5, +0.0, +0.5}, {+0.5, -2.0, +1.5}}};

  static constexpr scs_matrix_type Dt = {
    {{-1.166666666666666666667, 1.333333333333333333333,
      -0.1666666666666666666667},
     {0.1666666666666666666667, -1.333333333333333333333,
      1.166666666666666666667}}};

  static constexpr scs_matrix_type Nt = {
    {{0.5555555555555555555556, 0.5555555555555555555556,
      -0.1111111111111111111111},
     {-0.1111111111111111111111, 0.5555555555555555555556,
      0.5555555555555555555556}}};

  static constexpr linear_nodal_matrix_type Nlin = {{{1, 0.5, 0}, {0, 0.5, 1}}};

  static constexpr linear_scs_matrix_type Ntlin = {
    {{0.8333333333333333333333, 0.1666666666666666666667},
     {0.1666666666666666666667, 0.8333333333333333333333}}};

  static constexpr LocalArray<double[3]> Wl = {{0.3333333333333333333333,
                                                1.333333333333333333333,
                                                0.3333333333333333333333}};
};
#else
template <>
struct Coeffs<2>
{
  using nodal_matrix_type = LocalArray<double[3][3]>;
  using scs_matrix_type = LocalArray<double[2][3]>;
  using linear_nodal_matrix_type = LocalArray<double[2][3]>;
  using linear_scs_matrix_type = LocalArray<double[2][2]>;

  static constexpr nodal_matrix_type W = {{
    {+0.301258318378354124194, +0.15346642738699932044,
     -0.032075014954979209139},
    {+0.064150029909958418279, +1.02640047855933469246,
     +0.064150029909958418279},
    {-0.032075014954979209139, +0.15346642738699932044,
     +0.301258318378354124194},
  }};

  static constexpr nodal_matrix_type D = {
    {{-1.5, +2.0, -0.5}, {-0.5, +0.0, +0.5}, {+0.5, -2.0, +1.5}}};

  static constexpr scs_matrix_type Nt = {{
    {+0.45534180126147954892, +0.66666666666666666667, -0.12200846792814621559},
    {-0.12200846792814621559, +0.66666666666666666667, +0.45534180126147954892},

  }};

  static constexpr scs_matrix_type Dt = {{
    {-1.077350269189625764509, +1.154700538379251529, -0.077350269189625764509},
    {+0.077350269189625764509, -1.154700538379251529, +1.077350269189625764509},
  }};

  static constexpr linear_nodal_matrix_type Nlin = {{{1, 0.5, 0}, {0, 0.5, 1}}};

  static constexpr linear_scs_matrix_type Ntlin = {
    {{+0.7886751345948129, +0.21132486540518708},
     {+0.21132486540518708, +0.7886751345948129}}};

  static constexpr LocalArray<double[3]> Wl = {{0.422649730810374235491,
                                                1.154700538379251529018,
                                                0.422649730810374235491}};
};
#endif
template <>
struct Coeffs<3>
{
  using nodal_matrix_type = LocalArray<double[4][4]>;
  using scs_matrix_type = LocalArray<double[3][4]>;
  using linear_nodal_matrix_type = LocalArray<double[2][4]>;
  using linear_scs_matrix_type = LocalArray<double[2][3]>;

  static constexpr nodal_matrix_type W = {
    {{0.1583333333333333333333, 0.08527003148341972055897,
      -0.02653336739156976426149, 0.008333333333333333333333},
     {0.01875000000000000000000, 0.6807822566675890861716,
      0.09381441257389429086422, -0.01875000000000000000000},
     {-0.01875000000000000000000, 0.09381441257389429086422,
      0.6807822566675890861716, 0.01875000000000000000000},
     {0.008333333333333333333333, -0.02653336739156976426149,
      0.08527003148341972055897, 0.1583333333333333333333}}};

  static constexpr nodal_matrix_type D = {
    {{-3.000000000000000000000, 4.045084971874737120511,
      -1.545084971874737120511, 0.5000000000000000000000},
     {-0.8090169943749474241023, 0, 1.118033988749894848205,
      -0.3090169943749474241023},
     {0.3090169943749474241023, -1.118033988749894848205, 0,
      0.8090169943749474241023},
     {-0.5000000000000000000000, 1.545084971874737120511,
      -4.045084971874737120511, 3.000000000000000000000}}};

  static constexpr scs_matrix_type Nt = {
    {{0.4436491673103708442590, 0.6830127018922193233819,
      -0.1830127018922193233819, 0.05635083268962915574104},
     {-0.1250000000000000000000, 0.6250000000000000000000,
      0.6250000000000000000000, -0.1250000000000000000000},
     {0.05635083268962915574104, -0.1830127018922193233819,
      0.6830127018922193233819, 0.4436491673103708442590}}};

  static constexpr scs_matrix_type Dt = {
    {{-1.968245836551854221295, 2.086279825301749069499,
      -0.1497881521980406269098, 0.03175416344814577870518},
     {0.1250000000000000000000, -1.397542485937368560256,
      1.397542485937368560256, -0.1250000000000000000000},
     {-0.03175416344814577870518, 0.1497881521980406269098,
      -2.086279825301749069499, 1.968245836551854221295}}};

  static constexpr linear_nodal_matrix_type Nlin = {
    {{1.000000000000000000000, 0.7236067977499789360962,
      0.2763932022500210639038, 0},
     {0, 0.2763932022500210639038, 0.7236067977499789360962,
      1.000000000000000000000}}};

  static constexpr linear_scs_matrix_type Ntlin = {
    {{0.8872983346207417021390, 0.5000000000000000000000,
      0.1127016653792582978610},
     {0.1127016653792582978610, 0.5000000000000000000000,
      0.8872983346207417021390}}};

  static constexpr LocalArray<double[4]> Wl = {
    {0.225403330758516622964, 0.774596669241483377036, 0.774596669241483377036,
     0.225403330758516622964}};
};

template <>
struct Coeffs<4>
{
  using nodal_matrix_type = LocalArray<double[5][5]>;
  using scs_matrix_type = LocalArray<double[4][5]>;
  using linear_nodal_matrix_type = LocalArray<double[2][5]>;
  using linear_scs_matrix_type = LocalArray<double[2][4]>;

  static constexpr nodal_matrix_type W = {
    {{0.09695253015044793809126, 0.05331486033726615325831,
      -0.01703355712956939027094, 0.008677324897354785606149,
      -0.003047469849552061908736},
     {0.007164749846281057647491, 0.4553825323698518515422,
      0.07415214731068794802940, -0.02270891136390560444531,
      0.007164749846281057647491},
     {-0.008234559993457991477508, 0.04977863820387725848308,
      0.5968739307488739955942, 0.04977863820387725848308,
      -0.008234559993457991477508},
     {0.007164749846281057647491, -0.02270891136390560444531,
      0.07415214731068794802940, 0.4553825323698518515422,
      0.007164749846281057647491},
     {-0.003047469849552061908736, 0.008677324897354785606149,
      -0.01703355712956939027094, 0.05331486033726615325831,
      0.09695253015044793809126}}};

  static constexpr nodal_matrix_type D = {
    {{-5.000000000000000000000, 6.75650248872424000384,
      -2.666666666666666666667, 1.410164177942426662824,
      -0.5000000000000000000000},
     {-1.240990253030982857849, 0, 1.745743121887939050129,
      -0.763762615825973334431, 0.2590097469690171421513},
     {0.3750000000000000000000, -1.336584577695453335255, 0,
      1.336584577695453335255, -0.3750000000000000000000},
     {-0.2590097469690171421513, 0.763762615825973334431,
      -1.745743121887939050129, 0, 1.240990253030982857849},
     {0.5000000000000000000000, -1.410164177942426662824,
      2.666666666666666666667, -6.75650248872424000384,
      5.000000000000000000000}}};

  static constexpr scs_matrix_type Nt = {
    {{0.438915296653108505973, 0.68875165018946374130, -0.188740996194412276920,
      0.093822535645591629854, -0.032748486293751600206},
     {-0.124762477098893435448, 0.61060199273548065478, 0.64588385333726941978,
      -0.193176178570536025930, 0.061452809596679386824},
     {0.061452809596679386824, -0.193176178570536025930,
      0.645883853337269419777, 0.61060199273548065478,
      -0.124762477098893435448},
     {-0.0327484862937516002057, 0.093822535645591629854,
      -0.188740996194412276920, 0.68875165018946374130,
      0.438915296653108505973}}};

  static constexpr scs_matrix_type Dt = {
    {{-3.16076363584700881396, 3.3356394863695831491, -0.21917667813244703236,
      0.06189679094138317077, -0.01759596333151047359},
     {0.18902862696025261613, -1.94043567855863264649, 1.89976431193600509159,
      -0.19421821478237933699, 0.04586095444475427576},
     {-0.045860954444754275757, 0.19421821478237933699, -1.89976431193600509159,
      1.94043567855863264649, -0.18902862696025261613},
     {0.017595963331510473590, -0.06189679094138317077, 0.21917667813244703236,
      -3.33563948636958314914, 3.16076363584700881396}}};

  static constexpr linear_nodal_matrix_type Nlin = {
    {{1.000000000000000000000, 0.8273268353539885433534,
      0.5000000000000000000000, 0.1726731646460114566466, 0},
     {0, 0.1726731646460114566466, 0.5000000000000000000000,
      0.8273268353539885433534, 1.000000000000000000000}}};

  static constexpr linear_scs_matrix_type Ntlin = {
    {{0.9305681557970262307578, 0.6699905217924281286557,
      0.3300094782075718713443, 0.06943184420297371373110},
     {0.06943184420297371373110, 0.3300094782075718713443,
      0.6699905217924281286557, 0.9305681557970262307578}}};

  static constexpr LocalArray<double[5]> Wl = {
    {0.13886368840594742478, 0.52115526800919631042, 0.679962087169712529605,
     0.52115526800919631042, 0.13886368840594742478}};
};

} // namespace matrix_free
} // namespace nalu
} // namespace sierra

#endif
